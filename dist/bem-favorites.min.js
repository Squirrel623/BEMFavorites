var BEMFavorites=function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t,r){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.createSingleButtonContextMenu=function(e){var t=$("body").dialogWindow({uid:e.uid,offset:{top:e.top,left:e.left},toolBox:!0});t.window.contextmenu(function(){return!1});var r=$('<ul class="optionList"/>').appendTo(t),o=$("<li/>").appendTo(r);$('<div class="button"><span>'+e.text+"</span></div>").appendTo(o).click(function(){e.onClick()&&t.window.remove()})},t.bemInitPromise=(o=0,new Promise(function(e,t){if(Bem&&void 0!==Bem.emotes)return e(Bem.emotes);var r=setInterval(function(){++o>200&&t(new Error("Max waiting iterations reached. Is Berrymotes installed?")),void 0!==Bem.emotes&&(clearInterval(r),e(Bem.emotes))},100)}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createFavoritesDialog=function(e){var t=!0,r=$("body").dialogWindow({title:"BerryEmote Favorites",uid:"berryEmoteFavorites",center:!0,onClose:function(){t=!1}}),n=0,i=void 0,a=function(){!function(e){var t=e.resultsElement,r=e.favoritesStore,o=e.start,n=e.end;t.empty();for(var i=r.getFavorites(),a=o;a<i.length&&a<n;a++){var s=$("<span/>").css("margin","2px").append(Bem.getEmoteHtml(i[a]));Bem.postEmoteEffects(s,!0),t.append(s)}}({resultsElement:i,favoritesStore:e,start:50*n,end:50*(n+1)})};!function(e){var t=e.dialogContent,r=e.favoritesStore,o=e.requestReload;$("<div/>").text("Export").css({float:"right",cursor:"pointer","text-decoration":"underline","user-select":"none","margin-left":"5px"}).click(r.exportFavorites.bind(r)).appendTo(t),$("<div/>").text("Import").css({float:"right",cursor:"pointer","text-decoration":"underline","user-select":"none"}).click(function(){r.importFavorites().then(function(e){e&&o()})}).appendTo(t)}({dialogContent:r,favoritesStore:e,requestReload:function(){t&&(n=0,a())}}),$("<span/>").text("< Prev").addClass("bemf_prev_page").css({cursor:"pointer","text-decoration":"underline","user-select":"none"}).click(function(){n>0&&(n--,a())}).appendTo(r),$("<span/>").text("Next >").addClass("bemf_next_page").css({cursor:"pointer","text-decoration":"underline","margin-left":"5px","user-select":"none"}).click(function(){e.getFavorites().length>50*(n+1)&&(n++,a())}).appendTo(r),i=function(e,t,r){var n=$("<div/>").addClass("berryemotes-favorites-results").css({width:"500px",height:"500px","overflow-y":"scroll"}).appendTo(e);return n.on("click",".berryemote",function(e){if(Bem.lastFocus){var t=$(e.currentTarget),o=parseInt(t.attr("emote_id"),10),n=Bem.emotes[o];Bem.insertAtCursor(Bem.lastFocus,"[](/"+n.names[0]+")"),Bem.lastFocus.focus(),r()}}),n.on("contextmenu",".berryemote",function(e){var r=$(e.target),n=parseInt(r.attr("emote_id"),10);return(0,o.createSingleButtonContextMenu)({uid:"bemRemoveFavorite",top:e.pageY,left:e.pageX,text:"Remove From Favorites",onClick:function(){return t.removeEmote(n),r.remove(),!0}}),!1}),n}(r,e,function(){t=!1,r.window.close(),$(document.body).find(".dialogWindow.berrymotes").remove()}),a(),r.window.center()};var o=r(0)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.get=function(e){var t=localStorage.getItem(e);if(null===t)return null;try{return JSON.parse(t)}catch(e){return null}},t.set=function(e,t){localStorage.setItem(e,JSON.stringify(t))},t.clear=function(e){localStorage.removeItem(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.find=function(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return e[r]},t.remove=function(e,t){for(var r=[],o=0;o<e.length;o++)t(e[o])&&(r.push(e[o]),e.splice(o,1));return r},t.forEach=function(e,t){for(var r=0;r<e.length;r++)t(e[r])},t.isArray=function(e){return e&&e.constructor===Array},t.map=function(e,t){for(var r=[],o=0;o<e.length;o++)r.push(t(e[o]));return r},t.every=function(e,t){for(var r=0;r<e.length;r++)if(!t(e[r]))return!1;return!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FavoritesStore=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),n=r(3),i=r(2),a="bemFavorites";function s(e){return(0,n.isArray)(e)&&(0,n.every)(e,function(e){return(0,n.isArray)(e)&&e.length>0})}t.FavoritesStore=function(){function e(){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!Bem||!Bem.emotes)throw new Error("Berrymotes not installed or initialized");var t=(0,i.get)(a);if(null===t&&(t=[]),!s(t))throw new Error("Badly formed serialization");this.deserializeInput(t)}return o(e,[{key:"getFavorites",value:function(){return this.favoriteEmotes}},{key:"addEmote",value:function(e){return!(0,n.find)(this.favoriteEmotes,function(t){return t.id===e})&&(this.favoriteEmotes.push(Bem.emotes[e]),this.saveFavorites(),!0)}},{key:"removeEmote",value:function(e){var t=(0,n.remove)(this.favoriteEmotes,function(t){return t.id===e});return this.saveFavorites(),t.length>0}},{key:"clearFavorites",value:function(){this.favoriteEmotes=[],this.saveFavorites()}},{key:"importFavorites",value:function(){var e=this;console.log("Importing favorites");var t=$("body").dialogWindow({title:"Import Favorites",uid:"bemfImportFavorites",center:!0}),r=($("<div/>").text("Warning! Successfully importing will replace currently saved favorites!").css({"font-weight":"bold","margin-top":"5px","margin-bottom":"15px"}).appendTo(t),$("<input/>").attr("type","file").attr("accept",".bemf").appendTo(t)),o=r[0];return t.window.center(),new Promise(function(t,n){r.on("change",function(){if(o.files&&o.files[0]){var r=new FileReader;r.onload=function(r){if(null===r.target)return t(!1);var o=void 0;try{o=JSON.parse(r.target.result)}catch(e){return console.warn("Tried loading ill-formed input"),t(!1)}return s(o)?(e.deserializeInput(o),t(!0)):(console.warn("Tried loading ill-formed input"),t(!1))};try{r.readAsText(o.files[0])}catch(e){return console.warn("Tried loading ill-formed input"),t(!1)}}})}).then(function(e){return t.window.remove(),e},function(){return t.window.remove(),!1})}},{key:"exportFavorites",value:function(){var e=new Blob([JSON.stringify(this.serializeFavorites())],{type:"text/plain"}),t=document.createElement("a");t.download="bem-favorites.bemf",t.href=window.URL.createObjectURL(e),t.dataset.downloadurl=["text/plain",t.download,t.href].join(":"),t.click()}},{key:"serializeFavorites",value:function(){return(0,n.map)(this.favoriteEmotes,function(e){return e.names})}},{key:"deserializeInput",value:function(e){var t,r,o=(t=Bem.emotes,r={},(0,n.forEach)(t,function(e){(0,n.forEach)(e.names,function(t){r[t]=e.id})}),r),i=[];(0,n.forEach)(e,function(e){for(var t=void 0,r=0;r<e.length&&void 0===(t=Bem.emotes[o[e[r]]]);r++);void 0!==t&&i.push(t)}),this.favoriteEmotes=i}},{key:"saveFavorites",value:function(){(0,i.set)(a,this.serializeFavorites())}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StartBemFavorites=function(){a=new o.FavoritesStore;var e=Bem.showBerrymoteSearch;return Bem.showBerrymoteSearch=function(){e.apply(this,arguments),function(){var e=$("body").find(".berrymotes_search");if(1!==e.length)throw new Error("No BEM input found");e.width(250)}(),function(){var e=s().find('div:contains("Settings")');if(1!==e.length)throw new Error("Settings link not found");$("<div/>").text("Favs").css({float:"right",cursor:"pointer","text-decoration":"underline","margin-right":"5px"}).click(function(){return(0,i.createFavoritesDialog)(a)}).insertAfter(e)}(),s().find(".berrymotes_search_results").on("contextmenu",".berryemote",function(e){var t=$(e.target),r=parseInt(t.attr("emote_id"),10);return(0,n.createSingleButtonContextMenu)({uid:"bemAddFavorite",top:e.pageY,left:e.pageX,text:"Add To Favorites",onClick:function(){return a.addEmote(r),!0}}),!1})},function(){Bem.showBerrymoteSearch=e}};var o=r(4),n=r(0),i=r(1),a=void 0;function s(){var e=$("body").find(".berrymotes .dialogContent");if(1!==e.length)throw new Error("No BEM dialog found");return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dispose=function(){i&&i()};var o=r(5),n=r(0);console.log("BEMFavories Loaded");var i=void 0;n.bemInitPromise.then(function(){console.log("BEMFavorites Started"),i=(0,o.StartBemFavorites)()},function(e){console.error("BerryEmote Favorites failed to load. Do you have BerryEmotes installed?")})},function(e,t,r){e.exports=r(6)}]);